"use strict";var nSubject=0,arSubjectIds=[];function calc(){var t,e,a,r,n,d,u={},c=0,i=0,o=!0,s=0;for(var b in $("thead#thead-percentage").html(""),$("tbody#tbody-percentage").html(""),$("div#average-grade").html(""),arSubjectIds)if(t="tr#"+arSubjectIds[b],$(t).find("input#exclude").prop("checked"))s++;else{if(!validateInput(e=$(t).find("input#ranking").val(),a=$(t).find("input#same-ranking").val(),r=$(t).find("input#students").val(),n=$(t).find("input#completion-unit").val())){o=!1;break}e=Number(e),a=Number(a),r=Number(r),n=Number(n),d=getGrade(e,a,r),u["percentage"+b]={SubjectId:arSubjectIds[b],nPercentage:((e+(a-1)/2)/r*100).toFixed(2)},i+=d*n,c+=n,$(t).find("input#grade").val(d),0==b&&$("thead#thead-percentage").html("<th>백분율</th>"),$("tbody#tbody-percentage").append("<tr><td id='percentage"+b+"'></td></tr>"),$("td#percentage"+b).load("progress.html",function(){var t=u[$(this).attr("id")];$(this).find("div.progress-bar").addClass("progress-bar-info").attr("aria-valuenow",t.nPercentage).css("width",t.nPercentage+"%").text($("tr#"+t.SubjectId).find("input#name").val()+" "+t.nPercentage+"%")})}o&&(arSubjectIds.length-s?$("div#average-grade").html("<strong>평균 등급:</strong> "+(i/c).toFixed(2)):alert("성적을 입력해주세요."))}function addSubject(){var t="subject"+nSubject;arSubjectIds.push(t),$("tbody#tbody-subjects").append("<tr id='"+t+"'></tr>"),$("tr#"+t).load("subject.html",function(){$("a#remove-subject").click(function(){for(var t in arSubjectIds)if(arSubjectIds[t]==$(this).parent().parent().attr("id")){arSubjectIds.splice(t,1);break}$(this).parent().parent().remove()})}),nSubject++}function validateInput(t,e,a,r){return!t||isNaN(t)||t<1?(alert("모든 항목의 석차를 올바르게 입력해주세요."),!1):!e||isNaN(e)||e<1?(0==e?alert("동석차수가 없으면 1을 입력해주세요."):alert("모든 항목의 동석차수를 올바르게 입력해주세요."),!1):!a||isNaN(a)||a<1?(alert("모든 항목의 이수자수를 올바르게 입력해주세요."),!1):Number(t)+Number(e)-1>a?(alert("모든 항목이 (석차) + (동석차수) - 1 ≤ (이수자수) 조건을 만족하게 해주세요."),!1):!(!r||isNaN(r)||r<1)||(alert("모든 항목의 이수단위를 올바르게 입력해주세요."),!1)}function getGrade(t,e,a){var r=t+e-1;return r<=Math.round(.04*a)?1:r<=Math.round(.11*a)?2:r<=Math.round(.23*a)?3:r<=Math.round(.4*a)?4:r<=Math.round(.6*a)?5:r<=Math.round(.77*a)?6:r<=Math.round(.89*a)?7:r<=Math.round(.96*a)?8:9}$(document).ready(function(){addSubject(),$("button#add-subject").click(addSubject),$("button#calc").click(calc),$("[data-toggle='tooltip']").tooltip()});
